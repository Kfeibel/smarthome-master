<html>

<head>
  <title>Liste der intelligenten Geräte</title>
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <script src="js/bootstrap.min.js"></script>
  <link href="css/menu.css" rel="stylesheet">
  <script src="js/device.js"></script>
  <script src="js/interface.js"></script>
  <script src="js/markers.js"></script>


  <script>
      
     window.onload = function(){
        var devices = getAllDevices();
        for(var i = 0 ; i<devices.length ; i++){
            createItem(devices[i]);
        }

     } 

    function createItem(device){
        //console.log(device);

        var div = document.createElement("div");
        div.setAttribute("class", "square bg");
        div.setAttribute("id", device.arucoid);
        div.setAttribute("style", "background-image: url('img/background.jpg'" );
        div.setAttribute("onclick", "openModal(this, '"+device.name+"' , '"+device.id +"')");

        var div2 = document.createElement("div");
        div2.setAttribute("class", "content");

        var div3 = document.createElement("div");
        div3.setAttribute("class", "table");

        var div4 = document.createElement("div");
        div4.setAttribute("class", "table-cell");
        if(device.arucoid !=  ""){
            div4.innerHTML = device.name +  '<br>' +'ID: ' + device.arucoid;
        }else{
            div4.innerHTML = device.name +  '<br>' +'Keine ID hinterlegt';
        }

        div3.appendChild(div4);
        div2.appendChild(div3);
        div.appendChild(div2);
        document.body.appendChild(div);

    }

    function openModal(item, name, itemid){
        $('.modal-title').text(name);

        drawArucoMarker(item.id);   
        $('#myModal').attr('arucoid',item.id);
        $('#myModal').attr('itemid',itemid);
        $('#myModal').modal('toggle');
    }

    function drawArucoMarker(itemId){

        var canvas = document.getElementById('arucoCode');
        canvas.width = $('.square').width();
        canvas.height = $('.square').width();

        if(itemId != ""){
            canvasBuffer  = makeMarker(itemId , $('.square').width()-30,$('.square').width()-30);
            var ctx = canvas.getContext('2d');
            ctx.drawImage(canvasBuffer, 0, 0);
            $('#arucoID').val(itemId);
            
        } else{
            $('#arucoID').val('');
        }   

    }

    function check(){
        //console.log($('#arucoID').val());
        
        drawArucoMarker($('#arucoID').val());
    }

    function changeArucoMarker(){
        var itemid = $('#myModal').attr('itemid');
        var oldid = $('#myModal').attr('arucoid');
        var newid = $('#arucoID').val();

        updateArucoId(oldid, newid, itemid);

        location.reload();
    }



  </script>




</head>

<body style="font-family: arial;">
<button id="backbutton" onclick="location.href='index.html'"> &lt&lt</button>  
<div id="headline">
    <p>Liste aller bekannten intelligente Geräte des Systems. Klicke auf sie, um ihnen eine spezifische ID zu geben<br/>
        </p> 
</div>

<div id="myModal" class="modal fade" role="dialog">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title"></h4>
      </div>
      <div class="modal-body">
        <div>
            <p id="arucoText">ID: </p>
            <input id="arucoID" type="number" name="quantity" min="0" max="1023" onchange="check(this.value)">
        
        </div>
        
        <canvas id="arucoCode"></canvas>
        <p id="infoText">Der dargestellte Marker kann abgespeichert und ausgedruckt werden, um ihn an das entsprechende Geräte anzubringen. Falls die Größe nicht den Vorstellungen entspricht, kann auf folgender Seite ein beliebig großer Marker erstellt werden:</p>
        <a href="http://terpconnect.umd.edu/~jwelsh12/enes100/markergen.html" target="_blank"> Marker Erstellen</a>  
        
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-default" onclick="changeArucoMarker()" data-dismiss="modal">Bestätigen</button>
        <button type="button" class="btn btn-default" data-dismiss="modal">Schließen</button>
      </div>
    </div>

  </div>
</div>


</body>
  
</html>